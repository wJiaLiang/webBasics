<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <title>OpenLayers 基本农田图斑画线</title>
    <link rel="stylesheet" href="./css/ol@v7.4.0.css" />
    <style>
      #map {
        width: 100%;
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script src="./js/ol@v7.4.0.js"></script>
    <script>
      // 创建地图
      const map = new ol.Map({
        target: "map",
        layers: [
          // 多个图层叠加;
          new ol.layer.Tile({
            //   source: new ol.source.OSM()
            source: new ol.source.XYZ({
              url: "https://t0.tianditu.gov.cn/DataServer?T=ter_w&x={x}&y={y}&l={z}&tk=5b18e472a5abde351d0ed39a8294fd85",
              subdomains: ["0", "1", "2", "3", "4", "5", "6", "7"],
              crossOrigin: "anonymous",
              attributions:
                '© <a href="https://www.tianditu.gov.cn">天地图</a>',
            }),
          }),
          new ol.layer.Tile({
            source: new ol.source.XYZ({
              url: "https://t0.tianditu.gov.cn/DataServer?T=cta_w&x={x}&y={y}&l={z}&tk=5b18e472a5abde351d0ed39a8294fd85",
              subdomains: ["0", "1", "2", "3", "4", "5", "6", "7"],
              crossOrigin: "anonymous",
            }),
          }),
        ],
        view: new ol.View({
          center: ol.proj.fromLonLat([104.07, 30.57]),
          zoom: 12,
        }),
      });

      // 加载基本农田图斑（GeoJSON）
      const vectorSource = new ol.source.Vector({
        url: "./geo.json",
        format: new ol.format.GeoJSON(),
      });

      const vectorLayer = new ol.layer.Vector({
        source: vectorSource,
        style: function (feature) {
          return [
            new ol.style.Style({
              fill: new ol.style.Fill({
                color: "rgba(255, 255, 0, 0.3)", // 黄色半透明填充
              }),
              stroke: new ol.style.Stroke({
                color: "orange",
                width: 3,
              }),
              text: new ol.style.Text({
                text: feature.get("name"),
                fill: new ol.style.Fill({ color: "#000" }),
                stroke: new ol.style.Stroke({ color: "#fff", width: 2 }),
              }),
            }),
          ];
        },
      });

      map.addLayer(vectorLayer);
    </script>
  </body>
</html>
