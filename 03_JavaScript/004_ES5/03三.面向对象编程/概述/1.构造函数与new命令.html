<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>构造函数与new命令</title>
</head>
<body>


    <script type="text/javascript">
    //  对象是什么
        // 1.对象是单个实物的抽象。
        // 2.对象是一个容器，封装了属性（property）和方法（method）。

    //  构造函数
    //所谓“类”就是对象的模板，对象就是“类”的实例。但是，JavaScript 语言的对象体系，
    //不是基于“类”的，而是基于构造函数（constructor）和原型链（prototype）。

    //JavaScript 语言使用构造函数（constructor）作为对象的模板。所谓”构造函数”，
    //就是专门用来生成对象的函数。它提供模板，描述对象的基本结构。一个构造函数，可以生成多个对象，
    //这些对象都有相同的结构。构造函数的写法就是一个普通的函数，但是有自己的特征和用法。

    var Vehicle = function () {
        this.price = 1000;
    };
    //Vehicle就是构造函数，它提供模板，用来生成实例对象。为了与普通函数区别，构造函数名字的第一个字母通常大写。
    /*构造函数的特点有两个。
        函数体内部使用了this关键字，代表了所要生成的对象实例。
        生成对象的时候，必需用new命令，调用Vehicle函数。
    */


    </script>

    <script type="text/javascript">

    // 3.new 命令
   //   new命令的作用，就是执行构造函数，返回一个实例对象。
    var Vehicle = function () {
        this.price = 1000;
    };
    var v = new Vehicle();
    v.price // 1000
    
    //使用new命令时，根据需要，构造函数也可以接受参数。

    var Vehicle = function (p) {
        this.price = p;
    };
    var v = new Vehicle(500);
    //new命令本身就可以执行构造函数，所以后面的构造函数可以带括号，
    //也可以不带括号。下面两行代码是等价的。
    var v = new Vehicle();
    var v = new Vehicle;
    //如果不用new 命令内部this指向的是全局变量;


    </script>
    <script type="text/javascript">
    //  new 命令的原理
    // 使用new命令时，它后面的函数调用就不是正常的调用，而是依次执行下面的步骤。
        //1.创建一个空对象，作为将要返回的对象实例
        //2.将这个空对象的原型，指向构造函数的prototype属性
        //3.将这个空对象赋值给函数内部的this关键字
        //4.开始执行构造函数内部的代码

        //就是操作一个空对象（即this对象），将其“构造”为需要的样子。
        //如果构造函数内部有return语句，而且return后面跟着一个对象，
        //new命令会返回return语句指定的对象；否则，就会不管return语句，返回this对象。

        var Vehicle = function (){
            this.price = 1000;
            return { price: 2000 };
        };
        (new Vehicle()).price       // 2000

       // 另一方面，如果对普通函数（内部没有this关键字的函数）使用new命令，则会返回一个空对象。
       function getMessage() {
        return 'this is a message';
        }
        var msg = new getMessage();
        msg // {}
        typeof msg // "object"

//**************************************************
    // 函数内部可以使用new.target属性。如果当前函数是new命令调用，
    // new.target指向当前函数， 否则为undefined。
    
    //  new.target
    function f() {
        console.log(new.target === f);
    }
    f() // false
    new f() // true



    </script>
</body>
</html>